"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _ramdam=require("ramdam"),_ramdam2=_interopRequireDefault(_ramdam);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}exports.default=function(a){var b=a(),c=function(a){var c=0,d=_ramdam2.default.addIndex(_ramdam2.default.reduce)(function(a,b,d){return _ramdam2.default.isString(b)?(c++,_ramdam2.default.isEven(d)?a.collection(b):a.doc(b)):_ramdam2.default.isNumber(b)?a.limit(b):_ramdam2.default.isArray(b)?3==_ramdam2.default.length(b)?a.where.apply(a,_toConsumableArray(b)):2==_ramdam2.default.length(b)&&_ramdam2.default.includes(b[0])(["startAt","startAfter","endAt","endBefore"])?a[b[0]](b[1]):a.orderBy.apply(a,_toConsumableArray(b.slice(1))):void 0},b)(a);return{n:c,ref:d}},d=function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){var d,e,f,g;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d=c(b),e=d.n,f=d.ref,a.next=3,f.get();case 3:return g=a.sent,a.abrupt("return",{n:e,ref:f,ss:g});case 5:case"end":return a.stop();}},a,void 0)}));return function(){return a.apply(this,arguments)}}(),e=function(a){var b=a.shift(),d=c(a),e=d.ref;return{data:b,ref:e}},f=function(a){return a.exists?a.data():null},g={d:function d(a){var b=a.ss,c=a.n;if(_ramdam2.default.isOdd(c)){var e=[];return b.forEach(function(a){e.push(a.data())}),e}return f(b)},r:function d(a){var b=a.ss,c=a.n;if(_ramdam2.default.isOdd(c)){var e=[];return b.forEach(function(a){e.push(a)}),e}return b},s:function d(a){var b=a.ss,c=a.n;if(_ramdam2.default.isOdd(c)){var e=[];return b.forEach(function(a){e.push({id:a.id,data:a.data(),ss:a})}),e}return b.exists?{id:b.id,data:b.data(),ss:b}:null},k:function d(a){var b=a.ss,c=a.n;if(_ramdam2.default.isOdd(c)){var e={};return b.forEach(function(a){e[a.id]=a.data()}),e}return f(b)}},h=function(a){var b=a.pop(),d=c(a),e=d.n,f=d.ref;return{func:b,n:e,ref:f}},i=function(a,b,c){var d=e(b),f=d.data,g=d.ref;return _ramdam2.default.isNil(c)?g[a](f):g[a](f,c)},j=function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b,c){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.t0=g,a.t1=b,a.next=4,d(c);case 4:return a.t2=a.sent,a.abrupt("return",a.t0[a.t1].call(a.t0,a.t2));case 6:case"end":return a.stop();}},a,void 0)}));return function(){return a.apply(this,arguments)}}(),k=function(a,b){var c=h(b),d=c.func,e=c.n,f=c.ref;return f.onSnapshot(function(b){return d(g[a]({n:e,ss:b}))})},l=function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(c,d){var e,f,i,j;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e=h(d),f=e.func,i=e.n,j=e.ref,a.next=3,b.runTransaction(function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.t0=f,a.t1=b,a.t2=g,a.t3=c,a.t4=i,a.next=7,b.get(j);case 7:return a.t5=a.sent,a.t6={n:a.t4,ss:a.t5},a.t7=a.t2[a.t3].call(a.t2,a.t6),a.t8=j,a.t9={t:a.t1,data:a.t7,ref:a.t8},a.abrupt("return",(0,a.t0)(a.t9));case 13:case"end":return a.stop();}},a,void 0)}));return function(){return a.apply(this,arguments)}}());case 3:return a.abrupt("return",a.sent);case 4:case"end":return a.stop();}},a,void 0)}));return function(){return a.apply(this,arguments)}}();return{inc:a.FieldValue.increment,del:a.FieldValue.delete(),ts:a.Timestamp,batch:function(a){var d=b.batch(),f=!0,g=!1,h=void 0;try{for(var i,j=a[Symbol.iterator]();!(f=(i=j.next()).done);f=!0){var k=i.value,l=k.shift();if(_ramdam2.default.includes(l)(["set","update"])){var m=e(k),n=m.data,o=m.ref;d[l](o,n)}else if("upsert"===l){var p=e(k),q=p.data,r=p.ref;d.set(r,q,{merge:!0})}else if("delete"===l){var s=c(k),t=s.ref;d.delete(t)}}}catch(a){g=!0,h=a}finally{try{!f&&j.return&&j.return()}finally{if(g)throw h}}return d.commit()},tx:function d(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return l("d",b)},txR:function d(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return l("r",b)},txK:function d(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return l("k",b)},txS:function d(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return l("s",b)},on:function d(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return k("d",b)},onR:function d(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return k("r",b)},onK:function d(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return k("k",b)},onS:function d(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return k("s",b)},get:function d(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return j("d",b)},getR:function d(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return j("r",b)},getK:function d(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return j("k",b)},getS:function d(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return j("s",b)},add:function d(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return i("add",b)},set:function d(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return i("set",b)},upsert:function d(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return i("set",b,{merge:!0})},update:function d(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return i("update",b)},delete:function e(){for(var a=arguments.length,b=Array(a),d=0;d<a;d++)b[d]=arguments[d];return c(b).ref.delete()}}},module.exports=exports.default;